# Урок 4

## Домашнее задание

Необходимо провести нагрузочное тестирование сервиса Load mock service.

Проект должен содержать в себе конфигурирование и возможность настройки, также должны быть использованы json экстракторы для передачи значений в другие сэмплы.

1. Воспроизвести плавную нагрузку.
2. Зафиксировать результаты в web отчете jMeter.
3. Использовать компонент Backend Listener и настроить его для пушинга значений в графану.

Дополнительно:

- Написать скрипт для ведения дополнительной статистики в grafana.
- Воспроизвевти нагрузку не только request стилем но и транзакциями.
- Реализовать кастомные графики в Jmeter отчете. (Например количество статей)


<br>

## Инструкция по установке сервиса.

Для начала необходимо установить docker и docker-compose.

Далее переходим в текущую деректорию и вводим команду

> docker-compose up -d

После чего у вас понимуться 4 сервиса:

- Grafana
- Influx DB 
- Load mock service (WEB API)
- Postgres DB

<br>
<br>

## Load mock service

Для того чтобы попасть в сваггер тестируемого сервиса необходимо перейти по ссылке:

> http://localhost:5000/apidocs

<br>
<br>

## Influx db

Посылать статистику в графану можно с помощбю Influx Db через http запросы (база данных db0) следующим способом:

> curl -i -XPOST 'http://localhost:8086/write?db=db0' --data-binary 'cpu_load_short, host=server01, region=us-west value=0.64 1434055562000000000'

<br>
<br>

## Grafana

Смотреть статистику можно в графане (Пароль:Логин admin:admin) которая находится по адресу:

> http://localhost:3000

Для того чтобы посмотреть статистику с influx db необходимо его полключить.

1. Переходим на вкладку **settings -> data sources**
2. Нажимаем на кнопку **add data source**
3. Выбираем источник данных **influx db**
4. Заполняем поля:

- url: http://influx:8086
- Database: db0
- User: пустое поле !
- Password: Пустое поле !

5. Нажимаем на кнопку **Save & Test**

После этого можете создать Dashboard. Обязательно выбираем источник данных ту бд которую мы подключали ранее. Далее в select measurment вы увидите значение которые вы посылаете в influx.

### WARNING

При отправке значений в influx учитывайте unix timestamp иначе вы не будете видеть своей статистики на панели.
Так же учтите что в некоторых браузерах ссылки могут не открыватся так как они не https.

<br>